.attr('font-size', 32)<!DOCTYPE html>
<meta charset="utf-8">
<head>
<title>basemap -- pan & zoom</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<style type="text/css">

.overlay {
  fill: none;
  pointer-events: all;
}
.proposed {
  fill: #ccc;
  cursor: pointer;
}

.active {
  stroke: orange;
}

</style>
</head>

<body>
<script>






var json = {
"type": "FeatureCollection",
"name": "clip_map_geojson",
"crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
"features": [
{ "type": "Feature", "properties": { "id": 332 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -115.78302996316431, 29.423290646394523 ], [ -115.78302996316431, 34.379522720010847 ], [ -108.193198203024238, 34.379522720010847 ], [ -108.193198203024238, 29.423290646394523 ], [ -115.78302996316431, 29.423290646394523 ] ] ] ] } }
]
}

var yuma1 = [-114.752,32.669 ],
    yuma2 = [-114.399,32.372 ],
    yuma10_27 = [-114.336,32.349],
    yuma3 = [-113.697,32.158],
    tucson1_2 = [-112.968,31.929],
    tucson3 = [-109.821,31.339];

var imgHeight = 1078, imgWidth = 1403,      // Image dimensions (don't change these)
    width =  1403, height = 1078,             // Dimensions of cropped region
    active = d3.select(null);


var zoom = d3.zoom().translateExtent([[0,0], [width, height]])
    .extent([[0, 0], [width, height]]).on("zoom", zoomed)

var projection = d3.geoMercator().fitHeight([height], json);
var path = d3.geoPath().projection(projection);

d3.select('body')
  .append('button')
  .text('transition both - translate first')
  .on('click', function() {

    // console.log('d');
    //
    // proposedWall.call(clicked)

    g.transition()
    .duration(1500)
          // .call(zoom.scaleTo, 4)
          .transition()

          // .call(zoom.translateTo, projection(yuma1)[0],projection(yuma1)[1])
          .call( zoom.transform, d3.zoomIdentity.translate(-300,-900).scale(4) )

          .transition()
          .on('start',function(){

            proposedWall.each(function(d){

              console.log("hi");
              if (d.properties.name === "yuma1") {

                changeText(d.properties)


                 active = d3.select(this)

                 .transition()
                 .duration(1000)
                 .style("stroke-width", "15")
                 .style("stroke", "#ffff66")
                 .style("stroke-linecap","round")
                 .transition()
                 .duration(1000)
                 .style("stroke-width", "6")
                 .style("stroke", "#66b3ff")
                 .transition()
                 .duration(800)
                 .style("stroke-linecap","butt")

              }

            })

          })

        .transition()
    .duration(1500)
        .call(zoom.scaleTo, 4)
        .transition()
        .call(zoom.translateTo, projection(yuma2)[0],projection(yuma2)[1])
        .transition()
        .on('start',function(){

          proposedWall.each(function(d){

            console.log("hi");
            if (d.properties.name === "yuma2") {

              changeText(d.properties)

               active = d3.select(this)

               .transition()
               .duration(1000)
               .style("stroke-width", "15")
               .style("stroke", "#ffff66")
               .style("stroke-linecap","round")
               .transition()
               .duration(1000)
               .style("stroke-width", "6")
               .style("stroke", "#66b3ff")
               .transition()
               .duration(800)
               .style("stroke-linecap","butt")

            }

          })

        })



          .transition()


          .transition()
      .duration(1500)
          .call(zoom.translateTo, projection(yuma10_27)[0],projection(yuma10_27)[1])
          .transition()
          .on('start',function(){

            proposedWall.each(function(d){

              console.log("hi");
              if (d.properties.name === "yuma10_27") {


                changeText(d.properties)

                 active = d3.select(this)

                 .transition()
                 .duration(1000)
                 .style("stroke-width", "15")
                 .style("stroke", "#ffff66")
                 .style("stroke-linecap","round")
                 .transition()
                 .duration(1000)
                 .style("stroke-width", "6")
                 .style("stroke", "#66b3ff")
                 .transition()
                 .duration(800)
                 .style("stroke-linecap","butt")

              }

            })

          })


          .transition()
      .duration(1500)
          .call(zoom.scaleTo, 4)
          .transition()

          .call(zoom.translateTo, projection(yuma3)[0],projection(yuma3)[1])
          .transition()
          .on('start',function(){

            proposedWall.each(function(d){

              console.log("hi");
              if (d.properties.name === "yuma3") {

                changeText(d.properties)

                 active = d3.select(this)

                 .transition()
                 .duration(1000)
                 .style("stroke-width", "15")
                 .style("stroke", "#ffff66")
                 .style("stroke-linecap","round")
                 .transition()
                 .duration(1000)
                 .style("stroke-width", "6")
                 .style("stroke", "#66b3ff")
                 .transition()
                 .duration(800)
                 .style("stroke-linecap","butt")

              }

            })

          })

          .transition()
      .duration(1500)
          .call(zoom.scaleTo, 4)
          .transition()
          .call(zoom.translateTo, projection(tucson1_2)[0],projection(tucson1_2)[1])
          .transition()
          .on('start',function(){

            proposedWall.each(function(d){

              console.log("hi");
              if (d.properties.name === "tucson1") {

                changeText(d.properties)

                 active = d3.select(this)

                 .transition()
                 .duration(1000)
                 .style("stroke-width", "15")
                 .style("stroke", "#ffff66")
                 .style("stroke-linecap","round")
                 .transition()
                 .duration(1000)
                 .style("stroke-width", "6")
                 .style("stroke", "#66b3ff")
                 .transition()
                 .duration(800)
                 .style("stroke-linecap","butt")

              }

            })

          })

          .transition()
      .duration(1500)
          .call(zoom.scaleTo, 4)
          .transition()
          .call(zoom.translateTo, projection(tucson1_2)[0],projection(tucson1_2)[1])
          .transition()
          .on('start',function(){

            proposedWall.each(function(d){

              console.log("hi");
              if (d.properties.name === "tucson2") {

                changeText(d.properties)

                 active = d3.select(this)

                 .transition()
                 .duration(1000)
                 .style("stroke-width", "15")
                 .style("stroke", "#ffff66")
                 .style("stroke-linecap","round")
                 .transition()
                 .duration(1000)
                 .style("stroke-width", "6")
                 .style("stroke", "#66b3ff")
                 .transition()
                 .duration(800)
                 .style("stroke-linecap","butt")

              }

            })

          })




          .transition()
      .duration(1500)
          .call(zoom.scaleTo, 2)
          .transition()
          .call(zoom.translateTo, projection(tucson3)[0],projection(tucson3)[1])
          .transition()
          .on('start',function(){

            proposedWall.each(function(d){

              console.log("hi");
              if (d.properties.name === "tucson3") {

                changeText(d.properties)

                 active = d3.select(this)

                 .transition()
                 .duration(1000)
                 .style("stroke-width", "15")
                 .style("stroke", "#ffff66")
                 .style("stroke-linecap","round")
                 .transition()
                 .duration(1000)
                 .style("stroke-width", "6")
                 .style("stroke", "#66b3ff")
                 .transition()
                 .duration(800)
                 .style("stroke-linecap","butt")

              }

            })

          })



  })






svg = d3.select("body").append("svg")
.attr("viewBox", "100 200 1280 720")





var g = svg.append("g")
           .call(zoom)









g.append("image")
.attr("x",  0)
.attr("y", 0)
    .attr("width",  imgWidth + "px")
    .attr("height", imgHeight + "px")
    .attr("xlink:href", "asMap.png");


    var rect = svg.append('rect').attr('width', 500)
                   .attr('height', 220)
                   .attr('x', (width/1.5 -90))
                   .attr('y', height/4 -4)
                   .style('fill', 'white')
                   .style('opacity', .6)
                   .attr('stroke', 'black')
                   console.log(width/1.49);
    var textContractor = svg.append('text').text('The Trump administration has')
    .attr('x', width/1.49 -90)
    .attr('y', height/3.75 + 5)
    .attr('fill', 'black')
    .attr('font-size', 32)

    var textPlace = svg.append('text').text('')
    .attr('x', width/1.49 -90)
      .attr('y', height/3.75 + 168)

    .attr('id', "place1")
    .attr('fill', 'black')
    .attr('font-size', 32)

    var textCost = svg.append('text').text('awarded $1.95 billion in construction ')
    .attr('x', width/1.49 -90)
    .attr('y', height/3.75 + 42)

    .attr('fill', 'black')
    .attr('font-size', 32)
    // .attr('font-size', 16)

    var textCostPerMile = svg.append('text').text('contracts to three companies to')
    .attr('x', width/1.49 -90)

    .attr('y', height/3.75 + 84)
    .attr('fill', 'black')
    .attr('font-size', 32)

    var textMiles = svg.append('text').text('build more border walls in Arizona.')
    .attr('x', width/1.49 -90)
    .attr('y', height/3.75 + 126)
    .attr('fill', 'black')
    .attr('font-size', 32)


function changeText(properties){




  textContractor.transition().text(properties.contractor)
  .attr('font-size', 32)

                // .transition().duration(1000).attr('font-size', 22).attr('fill', '#ffff66')
                // .transition().duration(1000).attr('font-size', 20).attr('fill', 'black')


  textMiles.transition().text(properties.contractMiles)
  .attr('font-size', 32)
           // .transition().duration(1000).attr('font-size', 22).attr('fill', '#ffff66')
           // .transition().duration(1000).attr('font-size', 20).attr('fill', 'black')

  textCost.transition().text( properties.contractCost+" in total.")

  .attr('font-size', 32)
          // .transition().duration(1000).attr('font-size', 22).attr('fill', '#ffff66')
          // .transition().duration(1000).attr('font-size', 20).attr('fill', 'black')

  textCostPerMile.transition().text(properties.contractCostPerMile+" per mile.")
  .attr('font-size', 32)
                  // .transition().duration(1000).attr('font-size', 22).attr('fill', '#ffff66')
                  // .transition().duration(1000).attr('font-size', 20).attr('fill', 'black')

  textPlace.transition().text(properties.contractPlace)
  .attr('font-size', 32)

                  // .transition().duration(1000).attr('font-size', 22).attr('fill', '#ffff66')
                  // .transition().duration(1000).attr('font-size', 20).attr('fill', 'black')






                      // var tLength = this.getBoundingClientRect().width







                  rect.transition().duration(1000).attr('width', 530)
                                 .attr('height', 260)
                                 .attr('x', (width/1.5 -90) - 20)
                                 .attr('y', height/4 -24)
                                 .style('fill', '#ffff66')
                                 .style('stroke', '#ffff66')
                                 .style("stroke-opacity",  1)
                  .transition().duration(1000).attr('width', 525)
                                 .attr('height', 220)
                                 .attr('x', (width/1.5 -90))
                                 .attr('y', height/4 -4)
                                 .style('fill', 'white')
                                 .style('stroke', 'black')
                               //   .attr('width', function(){ var tLength = d3.select("#place1").node().getBBox().width;
                               //   console.log(d3.select("#place1").node());
                               //   console.log(tLength);
                               //   return tLength + 6
                               //
                               //
                               // })

}





d3.json('https://raw.githubusercontent.com/Alex-Devoid/Swiper-BorderMap-data/master/existing_wall.geojson', function(err, wall) {
d3.json('undercontract_border.geojson', function(err, proposed) {

wallExist = wall.features;



borderWall(wallExist)
proposedWallFun(proposed)


  })
})

var proposedWall;

    function proposedWallFun(proposed){


    proposedWall = g.selectAll('.proposed')
            .data(proposed.features).enter()
            .append('path')
            .style("stroke-width", "6")
            .style("stroke",  "#66b3ff")
            .style("stroke-opacity",  .90)
              .attr('class', "proposed")
              .attr('id', function(d){
                  if (d.properties.Name ==="Line 80") {
                          return "proposedLineLabel"
                      }
                    })

                .attr('d', path)
                 // .on("click", clicked);
                // .style("fill-opacity", 1)


    }





    function borderWall(wall){
      g.selectAll('.existingWall')
        .data(wall)
        .enter()
        .append('path')
        .attr('d', path)
        .attr('class', 'existingWall')
        // .style("fill", "red")
        .style("stroke-width", "8")

        .style("stroke", function(d) {
    //#ecda9a,#f3ad6a,#f3ad6a,#f7945d,#f3ad6a,#f66356,#ee4d5a
                  if (d.properties.gen_type === "pedestrian") {
                    return "#ee4d5a";
                  }else{
                    return "#f3ad6a"
                  }
          })
          .style("stroke-opacity",  .90)
        .attr("class", function(d){
                 if (d.properties.id === 13) {
                    return "pedestrianLabel";
                  }else if (d.properties.id === 271) {
                    return "vehicleLabel";
                  }
      })


        var existingVehicleLabel = {
        "type": "Feature",
        "geometry": {
        "type": "Point",
        "coordinates": [-112.047931,31.641742]
        }
        }


        var existingWallLabel = {
        "type": "Feature",
        "geometry": {
        "type": "Point",
        "coordinates": [-110.100959,31.334045]
        }
        }

        var existingVehicleLabelCent = path.centroid(existingVehicleLabel);
        var existingWallLabelCent = path.centroid(existingWallLabel);

        var lableG = g.append('g').attr('transform','translate('+existingWallLabelCent[0]+' '+existingWallLabelCent[1]+')')

        lableG.append('rect')
        .attr("class","labelPedertiran")
        .attr("height",25)
        .attr("width",.5)

        .attr("stroke","#ec3644")

        lableG.append("text").attr("text-anchor", "middle")
        .attr("dy","4.75%")
        .attr("font-size", "12px")
        .attr("fill", "#ec3644")

        .text("Existing wall")

        var lableV = g.append('g').attr('transform','translate('+existingVehicleLabelCent[0]+' '+existingVehicleLabelCent[1]+')')

        lableV.append('rect')
              .attr("class","labelVehicle")
              .attr("height",25)
              .attr("width",.5)
              .attr("stroke","#f3ad6a")

        lableV.append("text").attr("text-anchor", "middle")
              .attr("dy","4.75%")
              .attr("font-size", "12px")
              .attr("fill", "#d65011")
              .style("text-shadow", '1.5px 1.5px #000000, .9')
              .attr("font-weight", 200)
              .text("Vehicle Barrier")

    }



function reset() {

  active = d3.select(null);

  g.transition()
  .duration(1500)
      .call( zoom.transform, d3.zoomIdentity );
}


function zoomTo(location, scale) {

//   var t = d3.select(this);
//
  var point = projection(location);
  console.log(point);
//
// console.log(point[0]);
// console.log(point[1]);
//   zoom.translateTo(t,point[0],point[1])
//   zoom.scaleTo(t,scale)

  // d3.translateTo(point[0], point[1])
  // d3.zoomIdentity.scaleTo(scale)

  // d3.zoomIdentity.translate(0,0).scale(1)
  //

  var x = width / 2 - point[0] ;
  var y = width / 2 - point[1] ;

  var transform = d3.zoomIdentity
      .scale(scale)
      .translate(x, y)


  return transform;
}

// console.log(zoomTo(tucson3,4));

function zoomed() {

 g.attr("transform", d3.event.transform)
}

function jump() {
  var t = d3.select(this);
  (function repeat() {
    t = t.transition()
        .call(zoomTo(ny, 6).event)
      .transition()
      .call(zoomTo([-111.98811408309427,31.89197520707464], 6).event)
    .transition()
        .call(zoomTo(sf, 4).event)
        .each("end", repeat);
  })();
}

</script>
</body>

</html>
