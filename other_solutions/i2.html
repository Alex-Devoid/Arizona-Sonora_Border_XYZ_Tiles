<!DOCTYPE html>
<meta charset="utf-8">
<head>
<title>basemap -- pan & zoom</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<style type="text/css">

.overlay {
  fill: none;
  pointer-events: all;
}

</style>
</head>

<body>
<script>






var json = {
"type": "FeatureCollection",
"name": "clip_map_geojson",
"crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
"features": [
{ "type": "Feature", "properties": { "id": 332 }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ -115.78302996316431, 29.423290646394523 ], [ -115.78302996316431, 34.379522720010847 ], [ -108.193198203024238, 34.379522720010847 ], [ -108.193198203024238, 29.423290646394523 ], [ -115.78302996316431, 29.423290646394523 ] ] ] ] } }
]
}

var sf = [-114.392796,32.373276 ],
    ny = [-112.845207,31.882356 ],
    ty = [-110.644484,31.322747 ];

var imgHeight = 1078, imgWidth = 1403,      // Image dimensions (don't change these)
    width =  1403, height = 1078,             // Dimensions of cropped region
    active = d3.select(null);


var zoom = d3.zoom().on("zoom", zoomed)

var projection = d3.geoMercator().fitHeight([height], json);
var path = d3.geoPath().projection(projection);

d3.select('body')
  .append('button')
  .text('transition both - translate first')
  .on('click', function() {

    // console.log('d');
    //
    // proposedWall.call(clicked)

    g.transition()
        .duration(750)
          .call(zoom.scaleTo, 8)
          .transition()
          .call(zoom.translateTo, projection(sf)[0],projection(sf)[1])



        .transition()
        .duration(750)
        .call(zoom.scaleTo, 8)
        .transition()
        .call(zoom.translateTo, projection(ny)[0],projection(ny)[1])



          .transition()
          .duration(750)
          .call(zoom.scaleTo, 8)
          .transition()
          .call(zoom.translateTo, projection(ty)[0],projection(ty)[1])



  })




svg = d3.select("body").append("svg")
.attr("viewBox", "0 0 " +width+ " "+height)





var g = svg.append("g")
           .call(zoom)


g.append("image")
.attr("x",  0)
.attr("y", 0)
    .attr("width",  imgWidth + "px")
    .attr("height", imgHeight + "px")
    .attr("xlink:href", "asMap.png");


d3.json('https://raw.githubusercontent.com/Alex-Devoid/Swiper-BorderMap-data/master/existing_wall.geojson', function(err, wall) {
d3.json('https://raw.githubusercontent.com/Alex-Devoid/Swiper-BorderMap-data/master/Copy_of_US_Mexico_Border_Monuments.geojson', function(err, proposed) {

wallExist = wall.features;



borderWall(wallExist)
proposedWallFun(proposed)


  })
})

var proposedWall;

    function proposedWallFun(proposed){


    proposedWall = g.selectAll('.proposed')
            .data(proposed.features).enter()
            .append('path')
            .style("stroke-width", "8")
            .style("stroke",  "#4dabee")
              .attr('class', "proposed")
              .attr('id', function(d){
                  if (d.properties.Name ==="Line 80") {
                          return "proposedLineLabel"
                      }
                    })

                .attr('d', path)
                 // .on("click", clicked);
                // .style("fill-opacity", 1)


    }





    function borderWall(wall){
      g.selectAll('.existingWall')
        .data(wall)
        .enter()
        .append('path')
        .attr('d', path)
        .attr('class', 'existingWall')
        // .style("fill", "red")
        .style("stroke-width", "8")

        .style("stroke", function(d) {
    //#ecda9a,#f3ad6a,#f3ad6a,#f7945d,#f3ad6a,#f66356,#ee4d5a
                  if (d.properties.gen_type === "pedestrian") {
                    return "#ee4d5a";
                  }else{
                    return "#f3ad6a"
                  }
          })
        .attr("class", function(d){
                 if (d.properties.id === 13) {
                    return "pedestrianLabel";
                  }else if (d.properties.id === 271) {
                    return "vehicleLabel";
                  }
      })


        var existingVehicleLabel = {
        "type": "Feature",
        "geometry": {
        "type": "Point",
        "coordinates": [-112.047931,31.641742]
        }
        }


        var existingWallLabel = {
        "type": "Feature",
        "geometry": {
        "type": "Point",
        "coordinates": [-110.100959,31.334045]
        }
        }

        var existingVehicleLabelCent = path.centroid(existingVehicleLabel);
        var existingWallLabelCent = path.centroid(existingWallLabel);

        var lableG = g.append('g').attr('transform','translate('+existingWallLabelCent[0]+' '+existingWallLabelCent[1]+')')

        lableG.append('rect')
        .attr("class","labelPedertiran")
        .attr("height","4%")
        .attr("width",.5)

        .attr("stroke","#ec3644")

        lableG.append("text").attr("text-anchor", "middle")
        .attr("dy","4.75%")
        .attr("font-size", "12px")
        .attr("fill", "#ec3644")

        .text("15 Foot wall")

        var lableV = g.append('g').attr('transform','translate('+existingVehicleLabelCent[0]+' '+existingVehicleLabelCent[1]+')')

        lableV.append('rect')
              .attr("class","labelVehicle")
              .attr("height","4%")
              .attr("width",.5)
              .attr("stroke","#f3ad6a")

        lableV.append("text").attr("text-anchor", "middle")
              .attr("dy","4.75%")
              .attr("font-size", "12px")
              .attr("fill", "#f3966a")
              .style("text-shadow", '1.5px 1.5px #000000, .9')
              .attr("font-weight", 200)
              .text("Current Vehicle Barrier")

    }


function clicked(a) {
  // if (active.node() === this) return reset();
  // active.classed("active", false);
  // active = d3.select(this).classed("active", true);
// console.log(a.data());
//
var transScale =[];
var dataArray = a.data()
//
//
dataArray.forEach(function(d, i){
console.log(d);






  var bounds = path.bounds(d),
      dx = bounds[1][0] - bounds[0][0],
      dy = bounds[1][1] - bounds[0][1],
      x = (bounds[0][0] + bounds[1][0]) / 2,
      y = (bounds[0][1] + bounds[1][1]) / 2,
      scale = Math.max(1, Math.min(8, 0.9 / Math.max(dx / width, dy / height))),
      translate = [width / 2 - scale * x, height / 2 - scale * y];

transScale.push([translate[0],translate[1],scale])


    }
    )


  g.transition()

      .duration(750)
      .call( zoom.transform, d3.zoomIdentity.translate(transScale[0][0],transScale[0][1]).scale(transScale[0][2]))

      .duration(750)
      .call( zoom.transform, d3.zoomIdentity.translate(transScale[1][0],transScale[1][1]).scale(transScale[1][2]));




}








function reset() {
  active.classed("active", false);
  active = d3.select(null);

  g.transition()
      .duration(750)
      .call( zoom.transform, d3.zoomIdentity );
}


function zoomTo(location, scale) {

//   var t = d3.select(this);
//
  var point = projection(location);
  console.log(point);
//
// console.log(point[0]);
// console.log(point[1]);
//   zoom.translateTo(t,point[0],point[1])
//   zoom.scaleTo(t,scale)

  // d3.translateTo(point[0], point[1])
  // d3.zoomIdentity.scaleTo(scale)

  // d3.zoomIdentity.translate(0,0).scale(1)
  //

  var x = width / 2 - point[0] ;
  var y = width / 2 - point[1] ;

  var transform = d3.zoomIdentity
      .scale(scale)
      .translate(x, y)


  return transform;
}

console.log(zoomTo(ny,4));

function zoomed() {

 g.attr("transform", d3.event.transform)
}

function jump() {
  var t = d3.select(this);
  (function repeat() {
    t = t.transition()
        .call(zoomTo(ny, 6).event)
      .transition()
      .call(zoomTo([-111.98811408309427,31.89197520707464], 6).event)
    .transition()
        .call(zoomTo(sf, 4).event)
        .each("end", repeat);
  })();
}

</script>
</body>

</html>
